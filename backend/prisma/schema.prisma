generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int              @id @default(autoincrement())
  name                String           @unique
  email               String           @unique
  password            String
  isAdmin             Boolean          @default(false)
  preferredCurrencyId Int              @default(1)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime
  lastLogin           DateTime?
  BalanceSheet        BalanceSheet?
  CashSavings         CashSavings?
  IncomeStatement     IncomeStatement?
  Session             Session[]
  Event               Event[]
  PreferredCurrency   Currency         @relation(fields: [preferredCurrencyId], references: [id])
}

model Session {
  id        Int      @id @default(autoincrement())
  token     String
  expiresAt DateTime
  createdAt DateTime @default(now())
  isValid   Boolean  @default(true)
  userId    Int
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Expense {
  id              Int             @id @default(autoincrement())
  name            String
  amount          Float
  isId            Int
  IncomeStatement IncomeStatement @relation(fields: [isId], references: [id], onDelete: Cascade)
}

model Asset {
  id           Int          @id @default(autoincrement())
  name         String
  value        Float
  bsId         Int
  BalanceSheet BalanceSheet @relation(fields: [bsId], references: [id], onDelete: Cascade)
}

model Liability {
  id           Int          @id @default(autoincrement())
  name         String
  value        Float
  bsId         Int
  BalanceSheet BalanceSheet @relation(fields: [bsId], references: [id], onDelete: Cascade)
}

model BalanceSheet {
  id        Int         @id @default(autoincrement())
  userId    Int         @unique
  Asset     Asset[]
  User      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  Liability Liability[]
}

model IncomeLine {
  id              Int             @id @default(autoincrement())
  name            String
  amount          Float
  type            String
  isId            Int
  quadrant        String?
  IncomeStatement IncomeStatement @relation(fields: [isId], references: [id], onDelete: Cascade)
}

model IncomeStatement {
  id         Int          @id @default(autoincrement())
  userId     Int          @unique
  Expense    Expense[]
  IncomeLine IncomeLine[]
  User       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CashSavings {
  id     Int   @id @default(autoincrement())
  amount Float @default(0)
  userId Int   @unique
  User   User  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Currency {
  id         Int    @id @default(autoincrement())
  cur_symbol String
  cur_name   String
  User       User[]
}

model Event {
  id             Int      @id @default(autoincrement())
  timestamp      DateTime @default(now())
  actionType     String   // CREATE, UPDATE, DELETE
  entityType     String   // INCOME, EXPENSE, ASSET, LIABILITY
  entitySubtype  String?  // For income: EARNED, PORTFOLIO, PASSIVE
  beforeValue    String?  // JSON string of before state
  afterValue     String?  // JSON string of after state
  userId         Int
  entityId       Int      // ID of the affected entity
  User           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([entityType])
  @@index([entityId])
}
